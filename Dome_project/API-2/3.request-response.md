# REST API 请求

当您需要向 **[喵福禄][喵福禄]** 发出 REST API 请求时，你需要结合 HTTP 的 `GET` 、`POST` 、`PUT` 、`PATCH` 或 `DELETE` 方法、API 服务的 URL、要操作的资源 URI，以及一个或多个 [HTTP 请求头](#http-请求头)

**[喵福禄][喵福禄]** REST API 服务 URL:

- 正式环境: `https://api.meowflow.com.cn`
- 沙箱环境: `https://api-test.meowflow.com.cn`

在某些情况下，您可能需要在 GET 请求中包含 [公共查询参数](#公共查询参数)，用于对响应数据进行过滤、分页和排序等操作。大多数 POST、PUT 和 PATCH 请求则需要一个 JSON 格式的请求体。

> 温馨提示:
> 
> 请记得对所有 URL 参数使用 [URL encoding][URL encoding] 进行编码，以确保特殊字符能够正确传递。

以下是一个查询工序流任务详情的示例:

```bash
curl -v -X GET "https://api.meowflow.com.cn/open/v1/workflow-task/custom?customId=1234567890" \
  -H "Content-Type: application/json;charset=UTF-8" \
  -H "Authorization: Bearer <ACCESS_TOKEN>"
```

## 公共查询参数

对于大多数 REST API 的 GET 请求，你可以在请求 URI 上包含一个或多个查询参数，以过滤、分页并对 API 响应中的数据进行排序。
对于更详细的过滤参数，请参阅各个 GET 请求 API 文档。

如：分页可以使用 `page` 和 `pageSize` 参数，排序可以使用 `orderBy` 和 `sortBy` 参数，日期筛选可以使用 `startTime` 和
`endTime` 参数。



> 温馨提示：
>
> 1. 并非所有 API 都支持这些参数，具体需要查看对应 API 支持字段。
> 2. 日期格式: [RFC3339][RFC3339] eg: `2023-09-01T12:00:00+08:00` 或 `2023-09-01T12:00:00Z`。
> 3. 所有的 URL 参数都应该使用 [URL encoding][URL encoding] 格式编码，以确保特殊字符正确传递。

|    字段     |   类型   |     注释      | 是否必填 |  默认值  |                      备注                       |
|:---------:|:------:|:-----------:|:----:|:-----:|:---------------------------------------------:|
| startTime | string | 日期筛选 - 开始时间 |  NO  |  ""   | 日期格式: RFC3339 eg: `2023-09-01T12:00:00+08:00` |
|  endTime  | string | 日期筛选 - 结束时间 |  NO  |  ""   | 日期格式: RFC3339 eg: `2023-09-01T12:00:00+08:00` |
|  orderBy  | string |    排序字段     |  NO  |  id   |                具体查看对应 API 支持字段                |
|  sortBy   | string |    排序方式     |  NO  | desc  |              排序方式:asc=升序,desc=降序              |
|   page    |  int   |     页码      |  NO  |   1   |                 最小值：1，最大值：100                 |
| pageSize  |  int   |    每页数量     |  NO  |  20   |                 最小值：1，最大值：100                 |

## HTTP 请求头

常用的 HTTP 请求头有：

- `Content-Type`：用于指定请求体的格式，如 `application/json;charset=UTF-8`

  几乎所有的 API 都以 JSON 格式接收数据，所以 `Content-Type` 通常设置为 `application/json;charset=UTF-8`

- `Accept`：用于指定响应体的格式，如 `application/json;charset=UTF-8`

  几乎所有的 API 都以 JSON 格式返回数据，所以 `Accept` 通常设置为 `application/json;charset=UTF-8`

- `Authorization`：用于验证请求的身份，格式为 `Bearer <ACCESS TOKEN>`

  其中 `ACCESS TOKEN` 可在 [应用授权][应用授权] 中获取

# REST API 响应

每个 REST API 请求均会返回一个包含 HTTP 状态码和 JSON 格式响应体的响应。此响应体遵循统一的字段结构，旨在清晰传达请求的处理结果。

HTTP 状态码：用于概括请求的成功或失败状态。

响应体结构：

- code：业务状态码，用于进一步细分请求结果。
    - 成功时，code 为 0，表示操作成功。
    - 失败时，code 为非零值，表示特定错误。

- message：与 code 对应的描述信息，提供请求结果的详细说明。
    - 成功时，message 为 "OK"，表示操作成功完成。
    - 失败时，message 包含错误描述，帮助理解错误原因。

- data：响应数据内容，可能是一个对象、数组或者 `null` ，具体内容取决于请求的 API 。

|   字段    |         类型          |   注释    | 是否必填 |           备注           |
|:-------:|:-------------------:|:-------:|:----:|:----------------------:|
|  code   |         int         |  业务状态码  | YES  | 参考：[业务通用错误码](#业务通用错误码) |
| message |       string        | 业务状态码描述 | YES  |                        |
|  data   | array\|object\|null | 响应数据内容  | YES  |                        |

响应示例：

**请求成功**

``` json
{
    "code": 0,
    "message": "OK",
    "data": {
        "id": "326472364",
        "name": "jack.lai"
    }
}
```

**请求失败**

``` json
{
    "code": 100002,
    "message": "invalid param",
    "data": null
}
```

## 公共响应头

所有的 REST API 响应都会包含以下 HTTP 头信息：

- `Content-Type`：用于指定响应体的格式，如 `application/json;charset=UTF-8`
- `X-RateLimit-Limit`：用于指定该 API 允许的最大请求数，单位为次
- `X-RateLimit-Remaining`：用于指定该 API 允许的剩余请求数，单位为次
- `X-Trace-Id`：用于指定请求的追踪 ID，用于调试和排错
- `Trace-Id`：用于指定请求的追踪 ID，用于调试和排错，其值与 `X-Trace-Id` 相同
- `Traceparent`：比 `Trace-Id` 更详细的追踪信息，用于调试和排错，遵循 [W3C Trace Context][W3C Trace Context] 标准

## 成功的响应

对于成功的请求，HTTP 状态码为 `2xx`

|   Status code    |                    注释                    |
|:----------------:|:----------------------------------------:|
|     `200 OK`     |                  请求处理成功                  |
|  `201 Created`   |          一个 `POST` 方法成功创建了一个资源           |
|  `202 Accepted`  |        请求已被接受，将进行异步处理。如：批量创建工序流任务        |
| `204 No Content` | 服务器成功处理了请求，但没有返回任何内容。通常在 `DELETE` 请求中使用。 |

## 失败的响应

对于失败的请求，如：请求参数错误等由于客户端原因导致的请求失败，HTTP 状态码为 `4xx` 或者由于我们的服务端原因导致的请求失败，HTTP
状态码为 `5xx`。

### 业务通用错误码

> 以下是服务端常用错误码列表，部分未列入的错误码可以在具体 API 接口文档中查询到

#### HTTP 4xx 错误码

| Status code | 业务错误码  |             说明              |                      排错建议                      |
|:-----------:|:------:|:---------------------------:|:----------------------------------------------:|
|     400     | 100002 |        invalid param        |       请求参数缺失或者有误，更多错误信息请参阅请求返回的 message        |
|     400     | 100004 | bad request 或 invalid param |            传参错误，请确保请求信息、请求数据格式等是正确的            |
|     401     | 110007 |    用户 `Access Token` 无效     |     未传递 API访问令牌 或 已过期，需要传递有效的访问令牌或重新生成访问令牌     |
|     401     | 110009 |        Unauthorized         |               用户可能携带认证信息 ，但认证失败                |
|     403     | 100003 |          forbidden          |   权限不足，拒绝访问，请确保当前的 `Access Token` 具有操作该资源的权限   |
|     404     | 100008 |     resource not found      |        资源未找到，请检查传递的 资源ID 是否正确，资源是否成功被创建        |
|     405     | 100005 |     method not allowed      | HTTP 方法不支持，检查是否使用错误的请求方式，如：API 要求 POST 却使用 GET |
|     409     | 100018 |      resource conflict      |  该 API 无法完成请求的操作，因为它与当前正在处理的另一个请求冲突。请稍后重试该请求。  |
|     429     | 100006 |      too many requests      |              应用被限流，稍后再试，适当减小请求频率               |

#### HTTP 5xx 错误码

| Status code | 业务错误码  |           说明           |        排错建议         |
|:-----------:|:------:|:----------------------:|:-------------------:|
|     500     | 100000 |          通用错误          | 查看 message 或 联系开发者  |
|     500     | 100001 | internal service error | 内部错误，请稍后重试 或 联系开发者  |
|     500     | 100019 | internal service error | 内部错误，请稍后重试 或 联系开发者  |
|     503     | 100007 |  service unavailable   | 当前服务不可用，处于维护阶段，稍后再试 |

### 错误响应示例

```bash
curl -X POST "https://api.meowflow.com.cn/open/v1/authentication/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=client_credentials&client_id=BAD_APP_ID&client_secret=APP_SECRET"
```

由于 `client_id` 为 `BAD_APP_ID` 是错误的，这个请求将返回 HTTP `401 Unauthorized` 状态码和一个 JSON 响应体，其中列出了错误代码和错误描述：

```json
{
  "code": 110009,
  "message": "APP Client 身份验证失败",
  "data": null
}
```

<!--

TODO:: 修正所有文档中的链接，使其指向正确的页面

-->

[喵福禄]: https://meowflow.com.cn/ "喵福禄"

[RFC3339]: https://tools.ietf.org/html/rfc3339 "RFC3339"

[URL encoding]: https://en.wikipedia.org/wiki/Percent-encoding "URL encoding"

[应用授权]: ./2.authentication.md "应用授权"

[W3C Trace Context]: https://www.w3.org/TR/trace-context/ "W3C Trace Context"

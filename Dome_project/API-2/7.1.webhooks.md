# Webhooks 指南

## 概述

Webhooks 是一种通过 HTTP POST 请求将事件通知推送到您的服务器的机制。当您配置的 Webhooks 事件触发时， **[喵福禄][喵福禄]**
会向您的配置的 Webhook 地址推送 HTTP POST 请求。
它们可以被视为反向的 API 调用：不是您的系统调用 **[喵福禄][喵福禄]** ，而是 **[喵福禄][喵福禄]**
回调您的服务器。这对于接收由您的系统外部触发的事件通知特别有用，例如：当工序流任务处理完成后，可以通过 Webhooks 通知您。

## 配置 Webhooks

在您创建应用时，您可以在 **[喵福禄][喵福禄]** 的应用管理页面配置
Webhooks。关于应用管理的更多信息，请参阅 [快速开始][快速开始] 文档。

每个应用最多可以配置 5 个 Webhooks 地址，您可以为每个特定的 URL
配置不同的事件类型。您可以在 [Webhooks 事件类型][Webhooks 事件类型] 中查看支持的事件类型。

## 接收并处理 Webhooks 事件通知

当您订阅的 Webhooks 事件触发时， **[喵福禄][喵福禄]** 会向您所配置的 Webhooks 地址发送一个 HTTP POST 请求。请求的内容是一个 JSON 对象，包含有关事件的详细信息。

所有 Webhooks 推送结构都是相同的，只是 `payload` 字段的内容不同。`payload` 字段包含有关事件的详细信息，具体内容取决于事件的类型，可参阅 [Webhooks 事件类型][Webhooks 事件类型]。

以下是一个 Webhooks 请求的示例：

```json
{
  "id": "123456",
  "webhookId": "1234567",
  "appId": "12345",
  "event": "workflowTask.completed",
  "objectId": "task_123456",
  "payload": {
    "task_id": "task_123456",
    "status": "success",
    "result": {
      "output": "Hello, World!"
    }
  },
  "pushTime": "2024-08-31T12:00:00Z"
}
```

### Webhooks 请求字段说明

|    字段     |   类型   |                 说明                  |
|:---------:|:------:|:-----------------------------------:|
|    id     | string |               推送记录ID                |
| webhookId | string |            Webhooks 的 ID            |
|   appId   | string |                应用 ID                |
|   event   | string |                事件类型                 |
| objectId  | string |             触发事件的对象的 ID             |
|  payload  | object |   事件详细信息，根据 `event` 不同，其数据结构也不相同    |
| pushTime  | string | 推送时间，格式为 `yyyy-MM-dd'T'HH:mm:ss'Z'` |

您需要做以下几件事情：

1. **接收请求**：您的服务器需要有一个公开的 URL，可以接收 **[喵福禄][喵福禄]** 发送的 HTTP POST 请求。
2. **验证请求**：您需要验证 **[喵福禄][喵福禄]** 发送的请求，以确保它来自 **[喵福禄][喵福禄]**。
3. **处理请求**：您需要处理 **[喵福禄][喵福禄]** 发送的请求，以执行您的业务逻辑。
4. **响应请求**：您需要向 **[喵福禄][喵福禄]** 发送一个 HTTP 响应，以确认您已成功接收并处理了请求。

### 验证 Webhooks 请求

为了验证 **[喵福禄][喵福禄]** 发送的 Webhooks 请求，您需要使用签名验证机制。详细内容请参阅：[数据加签与验签][数据加签与验签]。

### 处理 Webhooks 请求

当您接收到 **[喵福禄][喵福禄]** 发送的 Webhooks 请求时，您需要解析请求的 JSON 数据，以获取事件的详细信息。您可以根据事件的类型和数据执行相应的业务逻辑。

### 响应 Webhooks 请求

当您成功接收并处理了 **[喵福禄][喵福禄]** 发送的 Webhooks 请求后，您需要向 **[喵福禄][喵福禄]** 发送一个 HTTP
响应。响应的状态码应该是 `2xx`，以确认您已成功接收并处理了请求。如果您返回的状态码不是 `2xx`， **[喵福禄][喵福禄]**
将认为请求失败，并会在一段时间后重试。 推送重试的时间间隔会逐渐增加，直到达到最大重试次数（默认为 10 次）。


[喵福禄]: https://meowflow.com.cn/ "喵福禄"

[快速开始]: ./1.quick-start.md "快速开始"

[Webhooks 事件类型]: ./7.2.webhooks-evnets.md "Webhooks 事件类型"

[数据加签与验签]: ./6.1.signature-verification.md "数据加签与验签"